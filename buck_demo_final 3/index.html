<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interactive Power Electronics Lab – Buck Converter</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="site-header">
    <h1>Interactive Power Electronics Lab</h1>
    <nav class="tabs">
      <a class="tab active" href="#" id="tab-buck">Buck</a>
      <a class="tab disabled" href="#" title="More topologies coming soon">Boost</a>
      <a class="tab disabled" href="#" title="More topologies coming soon">Buck-Boost</a>
    </nav>
  </header>

  <main class="layout">
    <section class="left">
      <div class="topology-card">
        <div class="topology-header">
          <h2>Buck Converter</h2>
          <div class="probe-hint">
            <span>Click a component to add its <b>voltage</b>. <kbd>⌘/Ctrl</kbd> + Click to add its <b>current</b>.</span>
          </div>
        </div>

        <!-- Inline SVG so components can be clicked / highlighted -->
        <svg id="buck-svg" viewBox="0 0 900 300" class="topology-svg" xmlns="http://www.w3.org/2000/svg" aria-label="Buck topology">
          <!-- Wires -->
          <path d="M40 150 H180" class="wire"/>
          <path d="M180 150 H260" class="wire"/>
          <path d="M260 150 H380" class="wire"/>
          <path d="M380 150 H520" class="wire"/>
          <path d="M520 150 H760" class="wire"/>
          <path d="M760 150 V230 H40 V150" class="wire"/>
          
          <!-- VIN source -->
          <g id="VIN" class="component" data-voltage="v_in" data-current="i_in">
            <circle cx="90" cy="200" r="25" class="symbol"/>
            <text x="90" y="208" class="label">Vi</text>
          </g>

          <!-- Switch (ideal) -->
          <g id="SW" class="component" data-voltage="v_sw" data-current="i_sw">
            <rect x="180" y="132" width="80" height="36" rx="6" class="symbol"/>
            <text x="220" y="127" class="label">S</text>
          </g>

          <!-- Diode -->
          <g id="duty" class="component" data-voltage="v_d" data-current="i_d">
            <polygon points="260,170 285,150 260,130" class="symbol"/>
            <rect x="285" y="138" width="12" height="24" class="symbol"/>
            <text x="270" y="120" class="label">D</text>
          </g>

          <!-- Inductor -->
          <g id="Lval" class="component" data-voltage="v_l" data-current="i_l">
            <path d="M380 150 c20 -35,40 35,60 0 c20 -35,40 35,60 0" class="symbol inductor"/>
            <text x="430" y="120" class="label">L</text>
          </g>

          <!-- Capacitor -->
          <g id="Cval" class="component" data-voltage="v_c" data-current="i_c">
            <line x1="580" y1="150" x2="580" y2="115" class="symbol"/>
            <line x1="600" y1="150" x2="600" y2="115" class="symbol"/>
            <line x1="590" y1="115" x2="590" y2="230" class="wire faint"/>
            <text x="590" y="110" class="label">C</text>
          </g>

          <!-- Load -->
          <g id="Rval" class="component" data-voltage="v_o" data-current="i_o">
            <rect x="740" y="110" width="40" height="80" rx="8" class="symbol"/>
            <text x="760" y="105" class="label">R</text>
          </g>
        </svg>
      </div>

      <div class="plot-card">
        <div class="plot-controls">
          <div class="waveform-select">
            <strong>Voltages:</strong>
            <label><input type="checkbox" class="wf-v" value="v_o" checked> v<sub>o</sub></label>
            <label><input type="checkbox" class="wf-v" value="v_sw"> v<sub>sw</sub></label>
            <label><input type="checkbox" class="wf-v" value="v_l"> v<sub>L</sub></label>
            <label><input type="checkbox" class="wf-v" value="v_in"> v<sub>i</sub></label>
          </div>
          <div class="waveform-select">
            <strong>Currents:</strong>
            <label><input type="checkbox" class="wf-i" value="i_l" checked> i<sub>L</sub></label>
            <label><input type="checkbox" class="wf-i" value="i_c"> i<sub>C</sub></label>
            <label><input type="checkbox" class="wf-i" value="i_d"> i<sub>D</sub></label>
            <label><input type="checkbox" class="wf-i" value="i_sw"> i<sub>S</sub></label>
          </div>
          <button id="reset-btn" class="btn">Reset to defaults</button>
        </div>
        <canvas id="plot-voltage" width="1100" height="260" aria-label="Voltage plot"></canvas>
        <canvas id="plot-current" width="1100" height="260" aria-label="Current plot"></canvas>
        <div class="legend" id="legend"></div>
      </div>
    </section>

    <aside class="right">
      <h3>Parameters</h3>
      <div class="param">
        <label>Input voltage Vi (V)</label>
        <div class="control"><input type="range" id="Vi" min="3" max="48" step="0.1"/><input type="number" id="Vi_num" step="0.1"/></div>
      </div>
      <div class="param">
        <label>Switching frequency f<sub>sw</sub> (kHz)</label>
        <div class="control"><input type="range" id="fsw" min="10" max="1000" step="1"/><input type="number" id="fsw_num" step="1"/></div>
      </div>
      <div class="param">
        <label>Duty cycle D (0–1)</label>
        <div class="control"><input type="range" id="duty" min="0.05" max="0.95" step="0.001"/><input type="number" id="duty_num" step="0.001"/></div>
      </div>
      <div class="param">
        <label>Inductance L (µH)</label>
        <div class="control"><input type="range" id="Lval" min="0.1" max="200" step="0.1"/><input type="number" id="Lval_num" step="0.1"/></div>
      </div>
      <div class="param">
        <label>Capacitance C (µF)</label>
        <div class="control"><input type="range" id="Cval" min="1" max="10000" step="1"/><input type="number" id="Cval_num" step="1"/></div>
      </div>
      <div class="param">
        <label>Load R (Ω)</label>
        <div class="control"><input type="range" id="Rval" min="0.1" max="200" step="0.1"/><input type="number" id="Rval_num" step="0.1"/></div>
      </div>
      <div class="param">
        <label>Periods (1–10)</label>
        <div class="control"><input type="range" id="periods" min="1" max="10" step="1"/><input type="number" id="periods_num" step="1"/></div>
      </div>

      <div class="note">
        <p><b>Model notes (v1):</b> Ideal buck in CCM. Duty sets V<sub>o</sub>=D·V<sub>i</sub>. Inductor ripple Δi<sub>L</sub>=((V<sub>i</sub>−V<sub>o</sub>)/L)·D·T<sub>s</sub>. Capacitor ripple obtained by integrating i<sub>C</sub>=i<sub>L</sub>−i<sub>o</sub> with zero-mean over a period.</p>
      </div>
    </aside>
  </main>

  <footer class="site-footer">
    <p>v1.0 • White theme, larger text, colorful traces, separate voltage/current plots, Cmd/Ctrl-click probing.</p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
